# -*- coding: utf-8 -*-

# Form implementation generated from reading ui file 'SuggestionQuery.ui'
#
# Created by: PyQt5 UI code generator 5.15.9
#
# WARNING: Any manual changes made to this file will be lost when pyuic5 is
# run again.  Do not edit this file unless you know what you are doing.


from PyQt5 import QtCore, QtGui, QtWidgets
import firebase_admin
from firebase_admin import credentials, db
from MainSuggestion import Ui_MainSuggestion


class Ui_SuggestionQuery(object):
    def setupUi(self, SuggestionQuery):
        SuggestionQuery.setObjectName("SuggestionQuery")
        SuggestionQuery.resize(800, 480)
        self.centralwidget = QtWidgets.QWidget(SuggestionQuery)
        self.centralwidget.setObjectName("centralwidget")
        self.textBox1 = QtWidgets.QLineEdit(self.centralwidget)
        self.textBox1.setGeometry(QtCore.QRect(152, 140, 521, 41))
        self.textBox1.setObjectName("textBox1")
        self.textBox1.textChanged.connect(self.text_changed)
        self.q_Key = QtWidgets.QPushButton(self.centralwidget)
        self.q_Key.setGeometry(QtCore.QRect(40, 230, 51, 41))
        self.q_Key.setObjectName("q_Key")
        self.q_Key.clicked.connect(lambda: self.update_text("q"))
        self.w_Key = QtWidgets.QPushButton(self.centralwidget)
        self.w_Key.setGeometry(QtCore.QRect(120, 230, 51, 41))
        self.w_Key.setObjectName("w_Key")
        self.w_Key.clicked.connect(lambda: self.update_text("w"))
        self.r_Key = QtWidgets.QPushButton(self.centralwidget)
        self.r_Key.setGeometry(QtCore.QRect(270, 240, 51, 41))
        self.r_Key.setObjectName("r_Key")
        self.r_Key.clicked.connect(lambda: self.update_text("r"))
        self.t_Key = QtWidgets.QPushButton(self.centralwidget)
        self.t_Key.setGeometry(QtCore.QRect(350, 240, 51, 41))
        self.t_Key.setObjectName("t_Key")
        self.t_Key.clicked.connect(lambda: self.update_text("t"))
        self.y_Key = QtWidgets.QPushButton(self.centralwidget)
        self.y_Key.setGeometry(QtCore.QRect(420, 240, 51, 41))
        self.y_Key.setObjectName("y_Key")
        self.y_Key.clicked.connect(lambda: self.update_text("y"))
        self.e_Key = QtWidgets.QPushButton(self.centralwidget)
        self.e_Key.setGeometry(QtCore.QRect(200, 230, 51, 41))
        self.e_Key.setObjectName("e_Key")
        self.e_Key.clicked.connect(lambda: self.update_text("e"))
        self.u_Key = QtWidgets.QPushButton(self.centralwidget)
        self.u_Key.setGeometry(QtCore.QRect(490, 240, 51, 41))
        self.u_Key.setObjectName("u_Key")
        self.u_Key.clicked.connect(lambda: self.update_text("u"))
        self.i_Key = QtWidgets.QPushButton(self.centralwidget)
        self.i_Key.setGeometry(QtCore.QRect(550, 240, 51, 41))
        self.i_Key.setObjectName("i_Key")
        self.i_Key.clicked.connect(lambda: self.update_text("i"))
        self.a_Key = QtWidgets.QPushButton(self.centralwidget)
        self.a_Key.setGeometry(QtCore.QRect(70, 290, 51, 41))
        self.a_Key.setObjectName("a_Key")
        self.a_Key.clicked.connect(lambda: self.update_text("a"))
        self.p_Key = QtWidgets.QPushButton(self.centralwidget)
        self.p_Key.setGeometry(QtCore.QRect(690, 240, 51, 41))
        self.p_Key.setObjectName("p_Key")
        self.p_Key.clicked.connect(lambda: self.update_text("p"))
        self.o_Key = QtWidgets.QPushButton(self.centralwidget)
        self.o_Key.setGeometry(QtCore.QRect(610, 240, 51, 41))
        self.o_Key.setObjectName("o_Key")
        self.o_Key.clicked.connect(lambda: self.update_text("o"))
        self.s_Key = QtWidgets.QPushButton(self.centralwidget)
        self.s_Key.setGeometry(QtCore.QRect(150, 290, 51, 41))
        self.s_Key.setObjectName("s_Key")
        self.s_Key.clicked.connect(lambda: self.update_text("s"))
        self.d_Key = QtWidgets.QPushButton(self.centralwidget)
        self.d_Key.setGeometry(QtCore.QRect(230, 300, 51, 41))
        self.d_Key.setObjectName("d_Key")
        self.d_Key.clicked.connect(lambda: self.update_text("d"))
        self.f_Key = QtWidgets.QPushButton(self.centralwidget)
        self.f_Key.setGeometry(QtCore.QRect(310, 300, 51, 41))
        self.f_Key.setObjectName("f_Key")
        self.f_Key.clicked.connect(lambda: self.update_text("f"))
        self.g_Key = QtWidgets.QPushButton(self.centralwidget)
        self.g_Key.setGeometry(QtCore.QRect(390, 300, 51, 41))
        self.g_Key.setObjectName("g_Key")
        self.g_Key.clicked.connect(lambda: self.update_text("g"))
        self.h_Key = QtWidgets.QPushButton(self.centralwidget)
        self.h_Key.setGeometry(QtCore.QRect(450, 300, 51, 41))
        self.h_Key.setObjectName("h_Key")
        self.h_Key.clicked.connect(lambda: self.update_text("h"))
        self.j_Key = QtWidgets.QPushButton(self.centralwidget)
        self.j_Key.setGeometry(QtCore.QRect(530, 300, 51, 41))
        self.j_Key.setObjectName("j_Key")
        self.j_Key.clicked.connect(lambda: self.update_text("j"))
        self.k_Key = QtWidgets.QPushButton(self.centralwidget)
        self.k_Key.setGeometry(QtCore.QRect(590, 300, 51, 41))
        self.k_Key.setObjectName("k_Key")
        self.k_Key.clicked.connect(lambda: self.update_text("k"))
        self.l_Key = QtWidgets.QPushButton(self.centralwidget)
        self.l_Key.setGeometry(QtCore.QRect(650, 300, 51, 41))
        self.l_Key.setObjectName("l_Key")
        self.l_Key.clicked.connect(lambda: self.update_text("l"))
        self.z_Key = QtWidgets.QPushButton(self.centralwidget)
        self.z_Key.setGeometry(QtCore.QRect(100, 340, 51, 41))
        self.z_Key.setObjectName("z_Key")
        self.z_Key.clicked.connect(lambda: self.update_text("z"))
        self.x_Key = QtWidgets.QPushButton(self.centralwidget)
        self.x_Key.setGeometry(QtCore.QRect(180, 340, 51, 41))
        self.x_Key.setObjectName("x_Key")
        self.x_Key.clicked.connect(lambda: self.update_text("x"))
        self.c_Key = QtWidgets.QPushButton(self.centralwidget)
        self.c_Key.setGeometry(QtCore.QRect(270, 340, 51, 41))
        self.c_Key.setObjectName("c_Key")
        self.c_Key.clicked.connect(lambda: self.update_text("c"))
        self.v_Key = QtWidgets.QPushButton(self.centralwidget)
        self.v_Key.setGeometry(QtCore.QRect(350, 350, 51, 41))
        self.v_Key.setObjectName("v_Key")
        self.v_Key.clicked.connect(lambda: self.update_text("v"))
        self.b_Key = QtWidgets.QPushButton(self.centralwidget)
        self.b_Key.setGeometry(QtCore.QRect(410, 350, 51, 41))
        self.b_Key.setObjectName("b_Key")
        self.b_Key.clicked.connect(lambda: self.update_text("b"))
        self.n_Key = QtWidgets.QPushButton(self.centralwidget)
        self.n_Key.setGeometry(QtCore.QRect(490, 340, 51, 41))
        self.n_Key.setObjectName("n_Key")
        self.n_Key.clicked.connect(lambda: self.update_text("n"))
        self.m_Key = QtWidgets.QPushButton(self.centralwidget)
        self.m_Key.setGeometry(QtCore.QRect(560, 340, 51, 41))
        self.m_Key.setObjectName("m_Key")
        self.m_Key.clicked.connect(lambda: self.update_text("m"))
        self.back_Key = QtWidgets.QPushButton(self.centralwidget)
        self.back_Key.setGeometry(QtCore.QRect(620, 350, 51, 41))
        self.back_Key.setObjectName("back_Key")
        self.back_Key.clicked.connect(self.backspace)
        self.space_Key = QtWidgets.QPushButton(self.centralwidget)
        self.space_Key.setGeometry(QtCore.QRect(270, 390, 221, 41))
        self.space_Key.setObjectName("space_Key")
        self.space_Key.clicked.connect(self.add_space)
        self.enter_Button = QtWidgets.QPushButton(self.centralwidget)
        self.enter_Button.setGeometry(QtCore.QRect(640, 20, 75, 23))
        self.enter_Button.setObjectName("enter_Button")
        self.enter_Button.clicked.connect(self.check_input)
        self.back_Button = QtWidgets.QPushButton(self.centralwidget)
        self.back_Button.setGeometry(QtCore.QRect(40, 10, 75, 23))
        self.back_Button.setObjectName("back_Button")
        self.label = QtWidgets.QLabel(self.centralwidget)
        self.label.setGeometry(QtCore.QRect(200, 50, 47, 13))
        self.label.setObjectName("label")
        self.label_2 = QtWidgets.QLabel(self.centralwidget)
        self.label_2.setGeometry(QtCore.QRect(200, 70, 47, 13))
        self.label_2.setObjectName("label_2")
        self.label_3 = QtWidgets.QLabel(self.centralwidget)
        self.label_3.setGeometry(QtCore.QRect(200, 100, 471, 16))
        self.label_3.setObjectName("label_3")
        self.suggestionsListBox = QtWidgets.QListWidget(self.centralwidget)
        self.suggestionsListBox.setGeometry(QtCore.QRect(150, 180, 521, 31))
        self.suggestionsListBox.setObjectName("suggestionsListBox")
        self.suggestionsListBox.itemClicked.connect(self.item_clicked)
        SuggestionQuery.setCentralWidget(self.centralwidget)
        self.menubar = QtWidgets.QMenuBar(SuggestionQuery)
        self.menubar.setGeometry(QtCore.QRect(0, 0, 800, 21))
        self.menubar.setObjectName("menubar")
        SuggestionQuery.setMenuBar(self.menubar)
        self.statusbar = QtWidgets.QStatusBar(SuggestionQuery)
        self.statusbar.setObjectName("statusbar")
        SuggestionQuery.setStatusBar(self.statusbar)
        # Hide the suggestions list box initially
        self.suggestionsListBox.setVisible(False)

        self.retranslateUi(SuggestionQuery)
        QtCore.QMetaObject.connectSlotsByName(SuggestionQuery)
        

        # Initialize Firebase Admin SDK only once
        if not firebase_admin._apps:
            cred = credentials.Certificate("keywords-e2507-firebase-adminsdk-ruto8-cc3abd39a8.json")
            firebase_admin.initialize_app(cred, {
                'databaseURL': 'https://keywords-e2507-default-rtdb.firebaseio.com/'
            })

        self.db_ref = db.reference()


    def retranslateUi(self, SuggestionQuery):
        _translate = QtCore.QCoreApplication.translate
        SuggestionQuery.setWindowTitle(_translate("SuggestionQuery", "SuggestionQuery"))
        self.q_Key.setText(_translate("SuggestionQuery", "q"))
        self.w_Key.setText(_translate("SuggestionQuery", "w"))
        self.r_Key.setText(_translate("SuggestionQuery", "r"))
        self.t_Key.setText(_translate("SuggestionQuery", "t"))
        self.y_Key.setText(_translate("SuggestionQuery", "y"))
        self.e_Key.setText(_translate("SuggestionQuery", "e"))
        self.u_Key.setText(_translate("SuggestionQuery", "u"))
        self.i_Key.setText(_translate("SuggestionQuery", "i"))
        self.a_Key.setText(_translate("SuggestionQuery", "a"))
        self.p_Key.setText(_translate("SuggestionQuery", "p"))
        self.o_Key.setText(_translate("SuggestionQuery", "o"))
        self.s_Key.setText(_translate("SuggestionQuery", "s"))
        self.d_Key.setText(_translate("SuggestionQuery", "d"))
        self.f_Key.setText(_translate("SuggestionQuery", "f"))
        self.g_Key.setText(_translate("SuggestionQuery", "g"))
        self.h_Key.setText(_translate("SuggestionQuery", "h"))
        self.j_Key.setText(_translate("SuggestionQuery", "j"))
        self.k_Key.setText(_translate("SuggestionQuery", "k"))
        self.l_Key.setText(_translate("SuggestionQuery", "l"))
        self.z_Key.setText(_translate("SuggestionQuery", "z"))
        self.x_Key.setText(_translate("SuggestionQuery", "x"))
        self.c_Key.setText(_translate("SuggestionQuery", "c"))
        self.v_Key.setText(_translate("SuggestionQuery", "v"))
        self.b_Key.setText(_translate("SuggestionQuery", "b"))
        self.n_Key.setText(_translate("SuggestionQuery", "n"))
        self.m_Key.setText(_translate("SuggestionQuery", "m"))
        self.back_Key.setText(_translate("SuggestionQuery", "âŒ«"))
        self.space_Key.setText(_translate("SuggestionQuery", "Space"))
        self.enter_Button.setText(_translate("SuggestionQuery", "Enter"))
        self.back_Button.setText(_translate("SuggestionQuery", "Back"))
        self.label.setText(_translate("SuggestionQuery", "Welcome to"))
        self.label_2.setText(_translate("SuggestionQuery", "Suggestions"))
        self.label_3.setText(_translate("SuggestionQuery", "Please enter a keyword describing your symptoms so I can provide you suggestions based on your current conditions."))

    def search_firestore(self, keyword):
        # Query the Firebase Realtime Database for keyword suggestions
        ref = self.db_ref.child("Keywords")
        results = ref.order_by_child("keyword").start_at(keyword).end_at(keyword + "\uf8ff").get()

        # Clear the current items in the suggestions list box
        self.suggestionsListBox.clear()

        if results:
            for key, value in results.items():
                if 'keyword' in value:
                    # Add the keyword to the list box
                    self.suggestionsListBox.addItem(value['keyword'])


    def update_text(self, letter):
        current_text = self.textBox1.text()
        self.textBox1.setText(current_text + letter)

    def add_space(self):
        current_text = self.textBox1.text()
        self.textBox1.setText(current_text + ' ')

    def backspace(self):
        current_text = self.textBox1.text()
        self.textBox1.setText(current_text[:-1])     

    def check_input(self):
        # Check if textBox1 is empty
        keyword = self.textBox1.text().strip()
        if keyword:
            self.search_firestore(keyword)
            self.open_main_suggestion(keyword)
        else:
            # Display message box indicating no input
            QtWidgets.QMessageBox.information(None, "Input Required", "Please enter a keyword before proceeding.")

    def open_main_suggestion(self, keyword):
        self.MainSuggestion_window = QtWidgets.QMainWindow()
        self.ui = Ui_MainSuggestion()
        self.ui.setupUi(self.MainSuggestion_window, keyword)  # Pass the keyword

        self.MainSuggestion_window.show()
        self.centralwidget.window().close()  # Close the current window

    def text_changed(self):
        keyword = self.textBox1.text().strip().lower()
        if keyword:
            self.search_firestore(keyword)
            self.suggestionsListBox.setVisible(True)
        else:
            self.suggestionsListBox.clear()
            self.suggestionsListBox.setVisible(False)

            



    def find_closest_matches(self, keyword, values):
        # Find closest matches to the keyword in the list of values
        # You can use a fuzzy matching algorithm or any other method to find closest matches
        # For simplicity, let's use a basic method here
        closest_matches = []
        for value in values:
            if keyword in value.lower():  # Check if the keyword is a substring of the value
                closest_matches.append(value)
        return closest_matches





    def item_clicked(self, item):
            self.textBox1.setText(item.text())
            self.suggestionsListBox.setVisible(False)


if __name__ == "__main__":
    import sys
    app = QtWidgets.QApplication(sys.argv)
    SuggestionQuery = QtWidgets.QMainWindow()
    ui = Ui_SuggestionQuery()
    ui.setupUi(SuggestionQuery)
    SuggestionQuery.show()
    sys.exit(app.exec_())
